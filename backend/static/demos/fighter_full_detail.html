<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Fighter - Full Detail</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            overflow: hidden;
            background: #000;
        }
        
        #canvas-container {
            width: 100vw;
            height: 100vh;
        }
        
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            color: white;
        }
        
        h2 {
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        button {
            display: block;
            width: 100%;
            padding: 10px 20px;
            margin-bottom: 10px;
            border: none;
            border-radius: 5px;
            background: #555;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        button:hover {
            background: #666;
        }
        
        button.active {
            background: #3b82f6;
        }
        
        .info {
            margin-top: 20px;
            font-size: 0.85rem;
            color: #999;
        }
        
        .info p {
            margin: 5px 0;
        }
        
        .tech-label {
            color: #4ade80;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    
    <div id="controls">
        <h2>Full Detail Fighter</h2>
        <button id="idle-btn" class="active">Fighting Stance</button>
        <button id="jab-btn">Jab</button>
        <button id="cross-btn">Cross</button>
        <button id="hook-btn">Lead Hook</button>
        <button id="kick-btn">Roundhouse Kick</button>
        <button id="block-btn">High Guard</button>
        
        <div class="info">
            <p class="tech-label">✓ Hand/finger detail</p>
            <p class="tech-label">✓ Facial features</p>
            <p class="tech-label">✓ Clothing textures</p>
            <p class="tech-label">✓ Muscle definition</p>
            <p>✓ Realistic proportions</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer;
        let leftFighter, rightFighter;
        let currentAnimation = 'idle';
        let time = 0;

        // Easing functions
        function easeInOut(t) {
            return t < 0.5 ? 2*t*t : 1 - Math.pow(-2*t + 2, 2) / 2;
        }

        function easeOut(t) {
            return 1 - (1-t)*(1-t);
        }

        function easeIn(t) {
            return t * t;
        }

        // ===========================
        // ANIMATION SYSTEM
        // ===========================
        
        class RealisticAnimator {
            constructor() {
                this.currentAnim = 'idle';
                this.animTime = 0;
            }
            
            setAnimation(name) {
                if (name !== this.currentAnim) {
                    this.currentAnim = name;
                    this.animTime = 0;
                }
            }
            
            update(dt) {
                this.animTime += dt;
            }
            
            getPose(fighter) {
                switch(this.currentAnim) {
                    case 'idle': return this.getIdlePose();
                    case 'jab': return this.getJabPose();
                    case 'cross': return this.getCrossPose();
                    case 'hook': return this.getHookPose();
                    case 'kick': return this.getKickPose();
                    case 'block': return this.getBlockPose();
                    default: return this.getIdlePose();
                }
            }
            
            getIdlePose() {
                const breathe = Math.sin(this.animTime * 1.5) * 0.01;
                
                return {
                    hips: { x: 0, y: 0.05, z: 0 },
                    spine: { x: 0.05, y: 0, z: 0 },
                    chest: { x: 0, y: -0.1, z: 0 },
                    chestScale: 1 + breathe,
                    neck: { x: 0, y: 0, z: 0 },
                    head: { x: 0, y: 0, z: 0 },
                    leftShoulder: { x: -1.0, y: 0, z: 0.4 },
                    leftElbow: { x: -1.4, y: 0, z: 0 },
                    leftWrist: { x: -0.3, y: 0, z: 0 },
                    rightShoulder: { x: -1.0, y: 0, z: -0.3 },
                    rightElbow: { x: -1.5, y: 0, z: 0 },
                    rightWrist: { x: -0.3, y: 0, z: 0 },
                    leftThigh: { x: 0.1, y: 0, z: 0 },
                    leftKnee: { x: 0.2, y: 0, z: 0 },
                    rightThigh: { x: -0.05, y: 0, z: 0 },
                    rightKnee: { x: 0.25, y: 0, z: 0 }
                };
            }
            
            getJabPose() {
                const cycleTime = 0.6;
                const t = (this.animTime % cycleTime) / cycleTime;
                
                if (t < 0.15) {
                    const phase = t / 0.15;
                    return {
                        hips: { x: 0, y: 0.05 - phase * 0.03, z: 0 },
                        spine: { x: 0.05, y: phase * 0.08, z: 0 },
                        chest: { x: 0, y: -0.1 + phase * 0.08, z: 0 },
                        chestScale: 1,
                        neck: { x: 0, y: 0, z: 0 },
                        head: { x: 0, y: 0, z: 0 },
                        leftShoulder: { x: -1.0, y: 0, z: 0.4 },
                        leftElbow: { x: -1.4, y: 0, z: 0 },
                        leftWrist: { x: -0.3, y: 0, z: 0 },
                        rightShoulder: { x: -1.0 - phase * 0.1, y: 0, z: -0.3 },
                        rightElbow: { x: -1.5 + phase * 0.2, y: 0, z: 0 },
                        rightWrist: { x: -0.3 + phase * 0.1, y: 0, z: 0 },
                        leftThigh: { x: 0.1, y: 0, z: 0 },
                        leftKnee: { x: 0.2, y: 0, z: 0 },
                        rightThigh: { x: -0.05, y: 0, z: 0 },
                        rightKnee: { x: 0.25, y: 0, z: 0 }
                    };
                } else if (t < 0.35) {
                    const phase = easeOut((t - 0.15) / 0.2);
                    return {
                        hips: { x: 0, y: 0.02 + phase * 0.06, z: 0 },
                        spine: { x: 0.05, y: 0.08 + phase * 0.15, z: 0 },
                        chest: { x: 0, y: -0.02 + phase * 0.2, z: 0 },
                        chestScale: 1,
                        neck: { x: 0, y: 0, z: 0 },
                        head: { x: 0, y: phase * 0.05, z: 0 },
                        leftShoulder: { x: -1.1, y: 0, z: 0.4 },
                        leftElbow: { x: -1.5, y: 0, z: 0 },
                        leftWrist: { x: -0.3, y: 0, z: 0 },
                        rightShoulder: { x: -1.1 - phase * 0.5, y: 0, z: -0.3 },
                        rightElbow: { x: -1.3 + phase * 1.1, y: 0, z: 0 },
                        rightWrist: { x: -0.2 - phase * 0.2, y: 0, z: 0 },
                        leftThigh: { x: 0.1, y: 0, z: 0 },
                        leftKnee: { x: 0.2, y: 0, z: 0 },
                        rightThigh: { x: -0.05 - phase * 0.08, y: 0, z: 0 },
                        rightKnee: { x: 0.25 + phase * 0.1, y: 0, z: 0 }
                    };
                } else {
                    const phase = 1.0 - easeIn((t - 0.35) / 0.65);
                    return {
                        hips: { x: 0, y: 0.05 + phase * 0.03, z: 0 },
                        spine: { x: 0.05, y: phase * 0.15, z: 0 },
                        chest: { x: 0, y: -0.1 + phase * 0.2, z: 0 },
                        chestScale: 1,
                        neck: { x: 0, y: 0, z: 0 },
                        head: { x: 0, y: phase * 0.05, z: 0 },
                        leftShoulder: { x: -1.0 - phase * 0.1, y: 0, z: 0.4 },
                        leftElbow: { x: -1.4 - phase * 0.1, y: 0, z: 0 },
                        leftWrist: { x: -0.3, y: 0, z: 0 },
                        rightShoulder: { x: -1.0 - phase * 0.6, y: 0, z: -0.3 },
                        rightElbow: { x: -1.5 + phase * 0.3, y: 0, z: 0 },
                        rightWrist: { x: -0.3 - phase * 0.1, y: 0, z: 0 },
                        leftThigh: { x: 0.1, y: 0, z: 0 },
                        leftKnee: { x: 0.2, y: 0, z: 0 },
                        rightThigh: { x: -0.05 - phase * 0.05, y: 0, z: 0 },
                        rightKnee: { x: 0.25 + phase * 0.05, y: 0, z: 0 }
                    };
                }
            }
            
            getCrossPose() {
                const cycleTime = 0.8;
                const t = (this.animTime % cycleTime) / cycleTime;
                
                if (t < 0.2) {
                    const phase = t / 0.2;
                    return {
                        hips: { x: 0, y: -phase * 0.25, z: 0 },
                        spine: { x: 0.05, y: -phase * 0.15, z: 0 },
                        chest: { x: 0, y: -0.1 - phase * 0.2, z: 0 },
                        chestScale: 1,
                        neck: { x: 0, y: -phase * 0.1, z: 0 },
                        head: { x: 0, y: -phase * 0.15, z: 0 },
                        leftShoulder: { x: -1.0, y: 0, z: 0.4 },
                        leftElbow: { x: -1.4, y: 0, z: 0 },
                        leftWrist: { x: -0.3, y: 0, z: 0 },
                        rightShoulder: { x: -1.0 - phase * 0.2, y: 0, z: -0.3 },
                        rightElbow: { x: -1.5, y: 0, z: 0 },
                        rightWrist: { x: -0.3, y: 0, z: 0 },
                        leftThigh: { x: 0.1, y: 0, z: 0 },
                        leftKnee: { x: 0.2, y: 0, z: 0 },
                        rightThigh: { x: -0.05 - phase * 0.1, y: 0, z: 0 },
                        rightKnee: { x: 0.25 + phase * 0.2, y: 0, z: 0 }
                    };
                } else if (t < 0.4) {
                    const phase = easeOut((t - 0.2) / 0.2);
                    return {
                        hips: { x: 0, y: -0.25 + phase * 0.55, z: 0 },
                        spine: { x: 0.05, y: -0.15 + phase * 0.5, z: 0 },
                        chest: { x: 0, y: -0.3 + phase * 0.45, z: 0 },
                        chestScale: 1,
                        neck: { x: 0, y: -0.1 + phase * 0.15, z: 0 },
                        head: { x: 0, y: -0.15 + phase * 0.2, z: 0 },
                        leftShoulder: { x: -1.2, y: 0, z: 0.5 },
                        leftElbow: { x: -1.6, y: 0, z: 0 },
                        leftWrist: { x: -0.3, y: 0, z: 0 },
                        rightShoulder: { x: -1.2 - phase * 0.6, y: 0, z: -0.3 },
                        rightElbow: { x: -1.5 + phase * 1.3, y: 0, z: 0 },
                        rightWrist: { x: -0.3 - phase * 0.3, y: 0, z: 0 },
                        leftThigh: { x: 0.1, y: 0, z: 0 },
                        leftKnee: { x: 0.2 - phase * 0.05, y: 0, z: 0 },
                        rightThigh: { x: -0.15 + phase * 0.15, y: 0, z: 0 },
                        rightKnee: { x: 0.45 - phase * 0.25, y: 0, z: 0 }
                    };
                } else {
                    const phase = 1.0 - easeInOut((t - 0.4) / 0.6);
                    return {
                        hips: { x: 0, y: 0.05 + phase * 0.25, z: 0 },
                        spine: { x: 0.05, y: phase * 0.3, z: 0 },
                        chest: { x: 0, y: -0.1 + phase * 0.25, z: 0 },
                        chestScale: 1,
                        neck: { x: 0, y: phase * 0.05, z: 0 },
                        head: { x: 0, y: phase * 0.05, z: 0 },
                        leftShoulder: { x: -1.0 - phase * 0.2, y: 0, z: 0.4 + phase * 0.1 },
                        leftElbow: { x: -1.4 - phase * 0.2, y: 0, z: 0 },
                        leftWrist: { x: -0.3, y: 0, z: 0 },
                        rightShoulder: { x: -1.0 - phase * 0.8, y: 0, z: -0.3 },
                        rightElbow: { x: -1.5 + phase * 0.3, y: 0, z: 0 },
                        rightWrist: { x: -0.3 - phase * 0.3, y: 0, z: 0 },
                        leftThigh: { x: 0.1, y: 0, z: 0 },
                        leftKnee: { x: 0.2, y: 0, z: 0 },
                        rightThigh: { x: -0.05 - phase * 0.1, y: 0, z: 0 },
                        rightKnee: { x: 0.25 + phase * 0.1, y: 0, z: 0 }
                    };
                }
            }
            
            getHookPose() {
                const cycleTime = 0.9;
                const t = (this.animTime % cycleTime) / cycleTime;
                
                if (t < 0.25) {
                    const phase = t / 0.25;
                    return {
                        hips: { x: 0, y: -phase * 0.35, z: 0 },
                        spine: { x: 0.05, y: -phase * 0.25, z: 0 },
                        chest: { x: 0, y: -0.1 - phase * 0.2, z: 0 },
                        chestScale: 1,
                        neck: { x: 0, y: -phase * 0.1, z: 0 },
                        head: { x: 0, y: -phase * 0.15, z: 0 },
                        leftShoulder: { x: -1.0 + phase * 0.3, y: -phase * 0.5, z: 0.4 },
                        leftElbow: { x: -1.4 - phase * 0.2, y: 0, z: 0 },
                        leftWrist: { x: -0.3, y: 0, z: 0 },
                        rightShoulder: { x: -1.2, y: 0, z: -0.3 },
                        rightElbow: { x: -1.6, y: 0, z: 0 },
                        rightWrist: { x: -0.3, y: 0, z: 0 },
                        leftThigh: { x: 0.1 - phase * 0.15, y: 0, z: 0 },
                        leftKnee: { x: 0.2 + phase * 0.15, y: 0, z: 0 },
                        rightThigh: { x: -0.05, y: 0, z: 0 },
                        rightKnee: { x: 0.25, y: 0, z: 0 }
                    };
                } else if (t < 0.45) {
                    const phase = easeOut((t - 0.25) / 0.2);
                    return {
                        hips: { x: 0, y: -0.35 + phase * 0.8, z: 0 },
                        spine: { x: 0.05, y: -0.25 + phase * 0.7, z: 0 },
                        chest: { x: 0, y: -0.3 + phase * 0.6, z: 0 },
                        chestScale: 1,
                        neck: { x: 0, y: -0.1 + phase * 0.25, z: 0 },
                        head: { x: 0, y: -0.15 + phase * 0.3, z: 0 },
                        leftShoulder: { x: -0.7 - phase * 0.2, y: -0.5 + phase * 1.3, z: 0.4 },
                        leftElbow: { x: -1.6, y: 0, z: 0 },
                        leftWrist: { x: -0.3 - phase * 0.2, y: 0, z: 0 },
                        rightShoulder: { x: -1.3, y: 0, z: -0.2 },
                        rightElbow: { x: -1.7, y: 0, z: 0 },
                        rightWrist: { x: -0.3, y: 0, z: 0 },
                        leftThigh: { x: -0.05, y: phase * 0.2, z: 0 },
                        leftKnee: { x: 0.35 - phase * 0.1, y: 0, z: 0 },
                        rightThigh: { x: -0.05, y: 0, z: 0 },
                        rightKnee: { x: 0.25, y: 0, z: 0 }
                    };
                } else {
                    const phase = 1.0 - easeInOut((t - 0.45) / 0.55);
                    return {
                        hips: { x: 0, y: 0.05 + phase * 0.4, z: 0 },
                        spine: { x: 0.05, y: phase * 0.4, z: 0 },
                        chest: { x: 0, y: -0.1 + phase * 0.3, z: 0 },
                        chestScale: 1,
                        neck: { x: 0, y: phase * 0.15, z: 0 },
                        head: { x: 0, y: phase * 0.15, z: 0 },
                        leftShoulder: { x: -1.0 + phase * 0.1, y: phase * 0.8, z: 0.4 },
                        leftElbow: { x: -1.4 - phase * 0.2, y: 0, z: 0 },
                        leftWrist: { x: -0.3 - phase * 0.2, y: 0, z: 0 },
                        rightShoulder: { x: -1.0 - phase * 0.3, y: 0, z: -0.3 + phase * 0.1 },
                        rightElbow: { x: -1.5 - phase * 0.2, y: 0, z: 0 },
                        rightWrist: { x: -0.3, y: 0, z: 0 },
                        leftThigh: { x: 0.1 + phase * -0.15, y: phase * 0.2, z: 0 },
                        leftKnee: { x: 0.2 + phase * 0.15, y: 0, z: 0 },
                        rightThigh: { x: -0.05, y: 0, z: 0 },
                        rightKnee: { x: 0.25, y: 0, z: 0 }
                    };
                }
            }
            
            getKickPose() {
                const cycleTime = 1.2;
                const t = (this.animTime % cycleTime) / cycleTime;
                
                if (t < 0.3) {
                    const phase = easeInOut(t / 0.3);
                    return {
                        hips: { x: 0, y: -phase * 0.4, z: 0 },
                        spine: { x: 0.05 - phase * 0.1, y: -phase * 0.25, z: 0 },
                        chest: { x: -phase * 0.1, y: -0.1 - phase * 0.15, z: 0 },
                        chestScale: 1,
                        neck: { x: 0, y: -phase * 0.1, z: 0 },
                        head: { x: -phase * 0.05, y: -phase * 0.1, z: 0 },
                        leftShoulder: { x: -0.8, y: -phase * 0.3, z: 0.4 },
                        leftElbow: { x: -1.2 + phase * 0.4, y: 0, z: 0 },
                        leftWrist: { x: -0.3, y: 0, z: 0 },
                        rightShoulder: { x: -0.8, y: phase * 0.3, z: -0.3 },
                        rightElbow: { x: -1.2 + phase * 0.4, y: 0, z: 0 },
                        rightWrist: { x: -0.3, y: 0, z: 0 },
                        leftThigh: { x: 0.1, y: 0, z: 0 },
                        leftKnee: { x: 0.25, y: 0, z: 0 },
                        rightThigh: { x: phase * 1.5, y: 0, z: 0 },
                        rightKnee: { x: 0.25 - phase * 1.8, y: 0, z: 0 }
                    };
                } else if (t < 0.5) {
                    const phase = easeOut((t - 0.3) / 0.2);
                    return {
                        hips: { x: 0, y: -0.4 + phase * 0.9, z: 0 },
                        spine: { x: -0.05 - phase * 0.1, y: -0.25 + phase * 0.55, z: 0 },
                        chest: { x: -0.1 - phase * 0.1, y: -0.25 + phase * 0.45, z: 0 },
                        chestScale: 1,
                        neck: { x: 0, y: -0.1 + phase * 0.2, z: 0 },
                        head: { x: -0.05 - phase * 0.1, y: -0.1 + phase * 0.15, z: 0 },
                        leftShoulder: { x: -0.8, y: -0.3 - phase * 0.3, z: 0.4 },
                        leftElbow: { x: -0.8, y: 0, z: 0 },
                        leftWrist: { x: -0.3, y: 0, z: 0 },
                        rightShoulder: { x: -0.8, y: 0.3 + phase * 0.3, z: -0.3 },
                        rightElbow: { x: -0.8, y: 0, z: 0 },
                        rightWrist: { x: -0.3, y: 0, z: 0 },
                        leftThigh: { x: 0.1, y: 0, z: 0 },
                        leftKnee: { x: 0.25, y: 0, z: 0 },
                        rightThigh: { x: 1.5 - phase * 0.6, y: phase * 0.8, z: 0 },
                        rightKnee: { x: -1.55 + phase * 1.4, y: 0, z: 0 }
                    };
                } else if (t < 0.7) {
                    const phase = (t - 0.5) / 0.2;
                    return {
                        hips: { x: 0, y: 0.5 - phase * 0.4, z: 0 },
                        spine: { x: -0.15 + phase * 0.1, y: 0.3 - phase * 0.2, z: 0 },
                        chest: { x: -0.2 + phase * 0.1, y: 0.2 - phase * 0.15, z: 0 },
                        chestScale: 1,
                        neck: { x: 0, y: 0.1 - phase * 0.05, z: 0 },
                        head: { x: -0.15 + phase * 0.05, y: 0.05 - phase * 0.03, z: 0 },
                        leftShoulder: { x: -0.8, y: -0.6 + phase * 0.3, z: 0.4 },
                        leftElbow: { x: -0.8 - phase * 0.2, y: 0, z: 0 },
                        leftWrist: { x: -0.3, y: 0, z: 0 },
                        rightShoulder: { x: -0.8, y: 0.6 - phase * 0.3, z: -0.3 },
                        rightElbow: { x: -0.8 - phase * 0.2, y: 0, z: 0 },
                        rightWrist: { x: -0.3, y: 0, z: 0 },
                        leftThigh: { x: 0.1, y: 0, z: 0 },
                        leftKnee: { x: 0.25, y: 0, z: 0 },
                        rightThigh: { x: 0.9 + phase * 0.4, y: 0.8 - phase * 0.5, z: 0 },
                        rightKnee: { x: -0.15 - phase * 0.8, y: 0, z: 0 }
                    };
                } else {
                    const phase = easeInOut((t - 0.7) / 0.3);
                    return {
                        hips: { x: 0, y: 0.1 - phase * 0.05, z: 0 },
                        spine: { x: 0.05 - phase * 0.05, y: 0.1 - phase * 0.1, z: 0 },
                        chest: { x: -0.1 + phase * 0.1, y: 0.05 - phase * 0.15, z: 0 },
                        chestScale: 1,
                        neck: { x: 0, y: 0.05 - phase * 0.05, z: 0 },
                        head: { x: -0.1 + phase * 0.1, y: 0.02 - phase * 0.02, z: 0 },
                        leftShoulder: { x: -0.8 - phase * 0.2, y: -0.3 + phase * 0.3, z: 0.4 },
                        leftElbow: { x: -1.0 - phase * 0.4, y: 0, z: 0 },
                        leftWrist: { x: -0.3, y: 0, z: 0 },
                        rightShoulder: { x: -0.8 - phase * 0.2, y: 0.3 - phase * 0.3, z: -0.3 },
                        rightElbow: { x: -1.0 - phase * 0.5, y: 0, z: 0 },
                        rightWrist: { x: -0.3, y: 0, z: 0 },
                        leftThigh: { x: 0.1, y: 0, z: 0 },
                        leftKnee: { x: 0.25 - phase * 0.05, y: 0, z: 0 },
                        rightThigh: { x: 1.3 - phase * 1.35, y: 0.3 - phase * 0.3, z: 0 },
                        rightKnee: { x: -0.95 + phase * 1.2, y: 0, z: 0 }
                    };
                }
            }
            
            getBlockPose() {
                return {
                    hips: { x: 0, y: 0, z: 0 },
                    spine: { x: 0.1, y: 0, z: 0 },
                    chest: { x: 0, y: -0.05, z: 0 },
                    chestScale: 0.98,
                    neck: { x: 0.25, y: 0, z: 0 },
                    head: { x: -0.15, y: 0, z: 0 },
                    leftShoulder: { x: -1.6, y: 0, z: 0.5 },
                    leftElbow: { x: -1.8, y: 0, z: 0 },
                    leftWrist: { x: -0.4, y: 0, z: 0 },
                    rightShoulder: { x: -1.6, y: 0, z: -0.5 },
                    rightElbow: { x: -1.8, y: 0, z: 0 },
                    rightWrist: { x: -0.4, y: 0, z: 0 },
                    leftThigh: { x: 0.1, y: 0, z: 0 },
                    leftKnee: { x: 0.3, y: 0, z: 0 },
                    rightThigh: { x: -0.05, y: 0, z: 0 },
                    rightKnee: { x: 0.35, y: 0, z: 0 }
                };
            }
        }

        // ===========================
        // TEXTURE CREATION
        // ===========================
        
        function createCanvasTexture(width, height, drawFn) {
            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            drawFn(ctx);
            const texture = new THREE.CanvasTexture(canvas);
            texture.needsUpdate = true;
            return texture;
        }

        function createFabricTexture(baseColor) {
            return createCanvasTexture(256, 256, (ctx) => {
                // Base color
                ctx.fillStyle = baseColor;
                ctx.fillRect(0, 0, 256, 256);
                
                // Fabric weave pattern
                for (let y = 0; y < 256; y += 4) {
                    for (let x = 0; x < 256; x += 4) {
                        const brightness = Math.random() * 0.1 - 0.05;
                        ctx.fillStyle = `rgba(255, 255, 255, ${Math.abs(brightness)})`;
                        if (brightness < 0) {
                            ctx.fillStyle = `rgba(0, 0, 0, ${Math.abs(brightness)})`;
                        }
                        ctx.fillRect(x, y, 2, 2);
                    }
                }
            });
        }

        function createSkinTexture(baseColor) {
            return createCanvasTexture(256, 256, (ctx) => {
                // Base skin tone
                ctx.fillStyle = baseColor;
                ctx.fillRect(0, 0, 256, 256);
                
                // Subtle skin texture
                for (let i = 0; i < 1000; i++) {
                    const x = Math.random() * 256;
                    const y = Math.random() * 256;
                    const brightness = Math.random() * 0.05 - 0.025;
                    ctx.fillStyle = `rgba(255, 255, 255, ${Math.abs(brightness)})`;
                    if (brightness < 0) {
                        ctx.fillStyle = `rgba(0, 0, 0, ${Math.abs(brightness)})`;
                    }
                    ctx.fillRect(x, y, 1, 1);
                }
            });
        }

        function createLeatherTexture() {
            return createCanvasTexture(256, 256, (ctx) => {
                // Dark leather base
                ctx.fillStyle = '#1a1a1a';
                ctx.fillRect(0, 0, 256, 256);
                
                // Leather grain
                for (let i = 0; i < 500; i++) {
                    const x = Math.random() * 256;
                    const y = Math.random() * 256;
                    const size = Math.random() * 3 + 1;
                    ctx.fillStyle = `rgba(${30 + Math.random() * 20}, ${30 + Math.random() * 20}, ${30 + Math.random() * 20}, 0.3)`;
                    ctx.fillRect(x, y, size, 1);
                }
            });
        }

        // ===========================
        // THREE.JS SETUP
        // ===========================

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a1a);

            camera = new THREE.PerspectiveCamera(
                50,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.set(0, 3, 10);
            camera.lookAt(0, 2, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const spotLight = new THREE.SpotLight(0xffffff, 1.2);
            spotLight.position.set(0, 15, 0);
            spotLight.castShadow = true;
            spotLight.shadow.mapSize.width = 2048;
            spotLight.shadow.mapSize.height = 2048;
            scene.add(spotLight);

            const rimLight = new THREE.DirectionalLight(0x4444ff, 0.6);
            rimLight.position.set(5, 5, -5);
            scene.add(rimLight);

            const fillLight = new THREE.DirectionalLight(0xffffff, 0.3);
            fillLight.position.set(-3, 2, 3);
            scene.add(fillLight);

            // Floor
            const floorGeometry = new THREE.PlaneGeometry(20, 20);
            const floorMaterial = new THREE.MeshStandardMaterial({
                color: 0x2a2a2a,
                roughness: 0.8,
                metalness: 0.2
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // Ring ropes
            const ropeGeometry = new THREE.CylinderGeometry(0.05, 0.05, 12, 16);
            const ropeMaterial = new THREE.MeshStandardMaterial({ color: 0xcc0000 });
            
            for (let i = 0; i < 3; i++) {
                const height = 0.5 + i * 0.5;
                const rope1 = new THREE.Mesh(ropeGeometry, ropeMaterial);
                rope1.rotation.z = Math.PI / 2;
                rope1.position.set(0, height, -6);
                scene.add(rope1);
                
                const rope2 = rope1.clone();
                rope2.position.z = 6;
                scene.add(rope2);
            }

            // Create detailed fighters
            leftFighter = createDetailedFighter(0xff4444, -3, 'red');
            rightFighter = createDetailedFighter(0x4444ff, 3, 'blue');
            scene.add(leftFighter.group);
            scene.add(rightFighter.group);

            // Button handlers
            document.getElementById('idle-btn').onclick = () => setAnimation('idle');
            document.getElementById('jab-btn').onclick = () => setAnimation('jab');
            document.getElementById('cross-btn').onclick = () => setAnimation('cross');
            document.getElementById('hook-btn').onclick = () => setAnimation('hook');
            document.getElementById('kick-btn').onclick = () => setAnimation('kick');
            document.getElementById('block-btn').onclick = () => setAnimation('block');

            window.addEventListener('resize', onWindowResize);
            animate();
        }

        function createDetailedFighter(color, xPosition, corner) {
            const fighter = {
                group: new THREE.Group(),
                animator: new RealisticAnimator(),
                bones: {}
            };
            
            fighter.group.position.x = xPosition;

            // Create textures
            const skinColor = corner === 'red' ? '#c89b7c' : '#8b6f5c';
            const shortsColor = corner === 'red' ? '#cc3333' : '#3333cc';
            
            const skinTexture = createSkinTexture(skinColor);
            const fabricTexture = createFabricTexture(shortsColor);
            const leatherTexture = createLeatherTexture();

            // Materials with textures
            const skinMaterial = new THREE.MeshStandardMaterial({
                map: skinTexture,
                roughness: 0.7,
                metalness: 0.1
            });

            const shortsMaterial = new THREE.MeshStandardMaterial({
                map: fabricTexture,
                roughness: 0.9,
                metalness: 0.0
            });

            const gloveMaterial = new THREE.MeshStandardMaterial({
                map: leatherTexture,
                roughness: 0.6,
                metalness: 0.2,
                color: corner === 'red' ? 0xff0000 : 0x0000ff
            });

            // === HIPS ===
            const hips = new THREE.Group();
            hips.position.y = 1.0;
            fighter.group.add(hips);
            fighter.bones.hips = hips;

            const hipsGeometry = new THREE.SphereGeometry(0.35, 20, 16);
            hipsGeometry.scale(1.6, 0.7, 1.0);
            const hipsMesh = new THREE.Mesh(hipsGeometry, shortsMaterial);
            hipsMesh.castShadow = true;
            hips.add(hipsMesh);

            // === SPINE/ABDOMEN ===
            const spine = new THREE.Group();
            spine.position.y = 0.3;
            hips.add(spine);
            fighter.bones.spine = spine;

            const spineGeometry = new THREE.CylinderGeometry(0.25, 0.3, 0.45, 20);
            const spineMesh = new THREE.Mesh(spineGeometry, skinMaterial);
            spineMesh.position.y = 0.225;
            spineMesh.castShadow = true;
            spine.add(spineMesh);

            // === CHEST/TORSO ===
            const chest = new THREE.Group();
            chest.position.y = 0.45;
            spine.add(chest);
            fighter.bones.chest = chest;

            const chestGeometry = new THREE.SphereGeometry(0.4, 24, 20);
            chestGeometry.scale(1.6, 1.3, 0.85);
            const chestMesh = new THREE.Mesh(chestGeometry, skinMaterial);
            chestMesh.position.y = 0.3;
            chestMesh.castShadow = true;
            chest.add(chestMesh);
            fighter.bones.chestMesh = chestMesh;

            // Pectoral definition
            const pecGeometry = new THREE.SphereGeometry(0.18, 16, 16);
            pecGeometry.scale(1.3, 0.7, 1.0);
            const pecLeft = new THREE.Mesh(pecGeometry, skinMaterial);
            pecLeft.position.set(0.25, 0.38, 0.15);
            pecLeft.castShadow = true;
            chest.add(pecLeft);
            
            const pecRight = pecLeft.clone();
            pecRight.position.x = -0.25;
            chest.add(pecRight);

            // === NECK ===
            const neck = new THREE.Group();
            neck.position.y = 0.6;
            chest.add(neck);
            fighter.bones.neck = neck;

            const neckGeometry = new THREE.CylinderGeometry(0.14, 0.18, 0.28, 20);
            const neckMesh = new THREE.Mesh(neckGeometry, skinMaterial);
            neckMesh.position.y = 0.14;
            neckMesh.castShadow = true;
            neck.add(neckMesh);

            // === HEAD ===
            const head = new THREE.Group();
            head.position.y = 0.28;
            neck.add(head);
            fighter.bones.head = head;

            // Skull
            const headGeometry = new THREE.SphereGeometry(0.28, 24, 24);
            headGeometry.scale(0.95, 1.1, 1.0);
            const headMesh = new THREE.Mesh(headGeometry, skinMaterial);
            headMesh.position.y = 0.28;
            headMesh.castShadow = true;
            head.add(headMesh);

            // Jaw
            const jawGeometry = new THREE.SphereGeometry(0.15, 16, 16);
            jawGeometry.scale(1.2, 0.6, 1.0);
            const jawMesh = new THREE.Mesh(jawGeometry, skinMaterial);
            jawMesh.position.set(0, 0.15, 0.08);
            jawMesh.castShadow = true;
            head.add(jawMesh);

            // Eyes
            const eyeGeometry = new THREE.SphereGeometry(0.04, 12, 12);
            const eyeMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.2 });
            const eyeLeft = new THREE.Mesh(eyeGeometry, eyeMaterial);
            eyeLeft.position.set(0.08, 0.3, 0.2);
            head.add(eyeLeft);
            
            const eyeRight = eyeLeft.clone();
            eyeRight.position.x = -0.08;
            head.add(eyeRight);

            // Pupils
            const pupilGeometry = new THREE.SphereGeometry(0.02, 10, 10);
            const pupilMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 });
            const pupilLeft = new THREE.Mesh(pupilGeometry, pupilMaterial);
            pupilLeft.position.set(0.08, 0.3, 0.22);
            head.add(pupilLeft);
            
            const pupilRight = pupilLeft.clone();
            pupilRight.position.x = -0.08;
            head.add(pupilRight);

            // Nose
            const noseGeometry = new THREE.ConeGeometry(0.04, 0.08, 8);
            noseGeometry.rotateX(Math.PI / 2);
            const noseMesh = new THREE.Mesh(noseGeometry, skinMaterial);
            noseMesh.position.set(0, 0.25, 0.22);
            noseMesh.castShadow = true;
            head.add(noseMesh);

            // Eyebrows
            const browGeometry = new THREE.BoxGeometry(0.12, 0.02, 0.02);
            const browMaterial = new THREE.MeshStandardMaterial({ color: 0x3a2816 });
            const browLeft = new THREE.Mesh(browGeometry, browMaterial);
            browLeft.position.set(0.08, 0.34, 0.2);
            browLeft.rotation.z = -0.2;
            head.add(browLeft);
            
            const browRight = browLeft.clone();
            browRight.position.x = -0.08;
            browRight.rotation.z = 0.2;
            head.add(browRight);

            // Ears
            const earGeometry = new THREE.SphereGeometry(0.06, 12, 12);
            earGeometry.scale(0.5, 1.0, 0.3);
            const earLeft = new THREE.Mesh(earGeometry, skinMaterial);
            earLeft.position.set(0.26, 0.28, 0.05);
            earLeft.castShadow = true;
            head.add(earLeft);
            
            const earRight = earLeft.clone();
            earRight.position.x = -0.26;
            head.add(earRight);

            // === ARMS (LEFT & RIGHT) ===
            ['left', 'right'].forEach(side => {
                const sign = side === 'left' ? 1 : -1;
                
                // SHOULDER
                const shoulder = new THREE.Group();
                shoulder.position.set(sign * 0.45, 0.45, 0);
                chest.add(shoulder);
                fighter.bones[`${side}Shoulder`] = shoulder;

                const shoulderGeometry = new THREE.SphereGeometry(0.15, 18, 18);
                shoulderGeometry.scale(1.1, 1.0, 1.0);
                const shoulderMesh = new THREE.Mesh(shoulderGeometry, skinMaterial);
                shoulderMesh.castShadow = true;
                shoulder.add(shoulderMesh);

                // UPPER ARM
                const upperArm = new THREE.Group();
                upperArm.position.y = -0.15;
                shoulder.add(upperArm);

                const upperArmGeometry = new THREE.CylinderGeometry(0.085, 0.11, 0.38, 18);
                const upperArmMesh = new THREE.Mesh(upperArmGeometry, skinMaterial);
                upperArmMesh.position.y = -0.19;
                upperArmMesh.castShadow = true;
                upperArm.add(upperArmMesh);

                // Bicep
                const bicepGeometry = new THREE.SphereGeometry(0.13, 14, 14);
                bicepGeometry.scale(0.8, 1.0, 0.8);
                const bicepMesh = new THREE.Mesh(bicepGeometry, skinMaterial);
                bicepMesh.position.y = -0.12;
                bicepMesh.castShadow = true;
                upperArm.add(bicepMesh);

                // ELBOW
                const elbow = new THREE.Group();
                elbow.position.y = -0.38;
                upperArm.add(elbow);
                fighter.bones[`${side}Elbow`] = elbow;

                const elbowGeometry = new THREE.SphereGeometry(0.095, 16, 16);
                const elbowMesh = new THREE.Mesh(elbowGeometry, skinMaterial);
                elbowMesh.castShadow = true;
                elbow.add(elbowMesh);

                // FOREARM
                const forearm = new THREE.Group();
                forearm.position.y = -0.1;
                elbow.add(forearm);

                const forearmGeometry = new THREE.CylinderGeometry(0.07, 0.095, 0.36, 18);
                const forearmMesh = new THREE.Mesh(forearmGeometry, skinMaterial);
                forearmMesh.position.y = -0.18;
                forearmMesh.castShadow = true;
                forearm.add(forearmMesh);

                // WRIST
                const wrist = new THREE.Group();
                wrist.position.y = -0.36;
                forearm.add(wrist);
                fighter.bones[`${side}Wrist`] = wrist;

                const wristGeometry = new THREE.SphereGeometry(0.08, 14, 14);
                const wristMesh = new THREE.Mesh(wristGeometry, skinMaterial);
                wristMesh.castShadow = true;
                wrist.add(wristMesh);

                // HAND (wrapped in glove)
                const handGroup = new THREE.Group();
                handGroup.position.y = -0.08;
                wrist.add(handGroup);

                // Palm
                const palmGeometry = new THREE.BoxGeometry(0.12, 0.08, 0.16);
                const palmMesh = new THREE.Mesh(palmGeometry, gloveMaterial);
                palmMesh.position.set(0, -0.04, 0);
                palmMesh.castShadow = true;
                handGroup.add(palmMesh);

                // Thumb
                const thumbGeometry = new THREE.CylinderGeometry(0.025, 0.03, 0.08, 10);
                thumbGeometry.rotateZ(Math.PI / 2);
                const thumbMesh = new THREE.Mesh(thumbGeometry, gloveMaterial);
                thumbMesh.position.set(sign * 0.07, -0.04, 0.04);
                thumbMesh.rotation.z = sign * 0.5;
                thumbMesh.castShadow = true;
                handGroup.add(thumbMesh);

                // Fingers (4)
                for (let f = 0; f < 4; f++) {
                    const fingerGeometry = new THREE.CylinderGeometry(0.018, 0.022, 0.1, 10);
                    const fingerMesh = new THREE.Mesh(fingerGeometry, gloveMaterial);
                    const offset = (f - 1.5) * 0.03;
                    fingerMesh.position.set(offset, -0.09, 0.08);
                    fingerMesh.rotation.x = 0.3;
                    fingerMesh.castShadow = true;
                    handGroup.add(fingerMesh);
                }

                // Glove padding
                const paddingGeometry = new THREE.SphereGeometry(0.1, 14, 14);
                paddingGeometry.scale(1.1, 0.8, 1.2);
                const paddingMesh = new THREE.Mesh(paddingGeometry, gloveMaterial);
                paddingMesh.position.set(0, -0.04, 0.02);
                paddingMesh.castShadow = true;
                handGroup.add(paddingMesh);
            });

            // === LEGS (LEFT & RIGHT) ===
            ['left', 'right'].forEach(side => {
                const sign = side === 'left' ? 1 : -1;
                
                // THIGH
                const thigh = new THREE.Group();
                thigh.position.set(sign * 0.22, -0.15, 0);
                hips.add(thigh);
                fighter.bones[`${side}Thigh`] = thigh;

                const thighGeometry = new THREE.CylinderGeometry(0.13, 0.16, 0.54, 20);
                const thighMesh = new THREE.Mesh(thighGeometry, skinMaterial);
                thighMesh.position.y = -0.27;
                thighMesh.castShadow = true;
                thigh.add(thighMesh);

                // Quad muscle
                const quadGeometry = new THREE.SphereGeometry(0.17, 14, 14);
                quadGeometry.scale(0.8, 1.2, 0.9);
                const quadMesh = new THREE.Mesh(quadGeometry, skinMaterial);
                quadMesh.position.set(0, -0.15, 0.02);
                quadMesh.castShadow = true;
                thigh.add(quadMesh);

                // KNEE
                const knee = new THREE.Group();
                knee.position.y = -0.54;
                thigh.add(knee);
                fighter.bones[`${side}Knee`] = knee;

                const kneeGeometry = new THREE.SphereGeometry(0.12, 16, 16);
                const kneeMesh = new THREE.Mesh(kneeGeometry, skinMaterial);
                kneeMesh.castShadow = true;
                knee.add(kneeMesh);

                // SHIN
                const shin = new THREE.Group();
                shin.position.y = -0.1;
                knee.add(shin);

                const shinGeometry = new THREE.CylinderGeometry(0.09, 0.12, 0.48, 20);
                const shinMesh = new THREE.Mesh(shinGeometry, skinMaterial);
                shinMesh.position.y = -0.24;
                shinMesh.castShadow = true;
                shin.add(shinMesh);

                // Calf muscle
                const calfGeometry = new THREE.SphereGeometry(0.13, 14, 14);
                calfGeometry.scale(0.8, 1.1, 0.9);
                const calfMesh = new THREE.Mesh(calfGeometry, skinMaterial);
                calfMesh.position.set(0, -0.12, 0.02);
                calfMesh.castShadow = true;
                shin.add(calfMesh);

                // FOOT
                const footGeometry = new THREE.BoxGeometry(0.16, 0.12, 0.32);
                footGeometry.translate(0, 0, 0.08);
                const footMesh = new THREE.Mesh(footGeometry, skinMaterial);
                footMesh.position.set(0, -0.52, 0);
                footMesh.castShadow = true;
                shin.add(footMesh);

                // Toe
                const toeGeometry = new THREE.SphereGeometry(0.08, 12, 12);
                toeGeometry.scale(1.0, 0.7, 1.2);
                const toeMesh = new THREE.Mesh(toeGeometry, skinMaterial);
                toeMesh.position.set(0, -0.52, 0.2);
                toeMesh.castShadow = true;
                shin.add(toeMesh);

                // Toenails (detail)
                for (let t = 0; t < 5; t++) {
                    const nailGeometry = new THREE.BoxGeometry(0.025, 0.01, 0.02);
                    const nailMaterial = new THREE.MeshStandardMaterial({ 
                        color: 0xf5e6d3,
                        roughness: 0.4
                    });
                    const nailMesh = new THREE.Mesh(nailGeometry, nailMaterial);
                    const offset = (t - 2) * 0.03;
                    nailMesh.position.set(offset, -0.47, 0.28);
                    shin.add(nailMesh);
                }
            });

            // === SHORTS WAISTBAND ===
            const waistbandGeometry = new THREE.TorusGeometry(0.32, 0.04, 8, 24);
            waistbandGeometry.rotateX(Math.PI / 2);
            const waistbandMesh = new THREE.Mesh(waistbandGeometry, shortsMaterial);
            waistbandMesh.position.y = 0.15;
            waistbandMesh.castShadow = true;
            hips.add(waistbandMesh);

            return fighter;
        }

        function updateFighterAnimation(fighter) {
            fighter.animator.update(0.016);
            const pose = fighter.animator.getPose(fighter);
            
            const bones = fighter.bones;
            
            bones.hips.rotation.set(pose.hips.x, pose.hips.y, pose.hips.z);
            bones.spine.rotation.set(pose.spine.x, pose.spine.y, pose.spine.z);
            bones.chest.rotation.set(pose.chest.x, pose.chest.y, pose.chest.z);
            bones.chestMesh.scale.y = pose.chestScale || 1;
            bones.neck.rotation.set(pose.neck.x, pose.neck.y, pose.neck.z);
            bones.head.rotation.set(pose.head.x, pose.head.y, pose.head.z);
            
            bones.leftShoulder.rotation.set(pose.leftShoulder.x, pose.leftShoulder.y, pose.leftShoulder.z);
            bones.leftElbow.rotation.set(pose.leftElbow.x, pose.leftElbow.y, pose.leftElbow.z);
            bones.leftWrist.rotation.set(pose.leftWrist.x, pose.leftWrist.y, pose.leftWrist.z);
            
            bones.rightShoulder.rotation.set(pose.rightShoulder.x, pose.rightShoulder.y, pose.rightShoulder.z);
            bones.rightElbow.rotation.set(pose.rightElbow.x, pose.rightElbow.y, pose.rightElbow.z);
            bones.rightWrist.rotation.set(pose.rightWrist.x, pose.rightWrist.y, pose.rightWrist.z);
            
            bones.leftThigh.rotation.set(pose.leftThigh.x, pose.leftThigh.y, pose.leftThigh.z);
            bones.leftKnee.rotation.set(pose.leftKnee.x, pose.leftKnee.y, pose.leftKnee.z);
            bones.rightThigh.rotation.set(pose.rightThigh.x, pose.rightThigh.y, pose.rightThigh.z);
            bones.rightKnee.rotation.set(pose.rightKnee.x, pose.rightKnee.y, pose.rightKnee.z);
        }

        function setAnimation(anim) {
            currentAnimation = anim;
            leftFighter.animator.setAnimation(anim);
            rightFighter.animator.setAnimation(anim);
            
            document.querySelectorAll('#controls button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(anim + '-btn').classList.add('active');
        }

        function animate() {
            requestAnimationFrame(animate);
            time += 0.016;

            updateFighterAnimation(leftFighter);
            updateFighterAnimation(rightFighter);

            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        init();
    </script>
</body>
</html>
